<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script>
      // Load theme immediately to prevent flash
      (function() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          document.documentElement.setAttribute('data-theme', savedTheme);
        }
      })();
    </script>
    <link rel="icon" type="image/x-icon" href="./src/assets/favicon.ico" />
    <title>OpenMined | Chat for Network Sourced AI.</title>
    <link rel="stylesheet" href="./src/styles/main.css" />
    <link rel="stylesheet" href="./src/styles/chat.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script> -->
    <script src="./src/components/site-header.js"></script>
    <script src="./src/components/site-footer.js"></script>
    <!-- <script src="./src/components/site-spinner.js"></script> -->
    <script src="./src/components/back-to-top.js"></script>
    <!-- <script type="text/javascript">
      (function (c, l, a, r, i, t, y) {
        c[a] =
          c[a] ||
          function () {
            (c[a].q = c[a].q || []).push(arguments);
          };
        t = l.createElement(r);
        t.async = 1;
        t.src = "https://www.clarity.ms/tag/" + i;
        y = l.getElementsByTagName(r)[0];
        y.parentNode.insertBefore(t, y);
      })(window, document, "clarity", "script", "r4hjqoa5tp");
    </script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script> -->
  </head>
  <body>
    <div class="restricted-overlay">
      <div class="restricted-message">
        <strong>Access currently restricted.</strong><br>
        Please contact OpenMined to try it out.
        <br><br>
        <a href="index.html" class="btn btn-primary" style="margin-top: 0.5em; font-size: 1rem;">Go back to Home</a>
      </div>
    </div>
    <site-header
      logo-src="./src/assets/openmined.png"
      logo-text="OpenMined"
      current-page="chat"
    >
    </site-header>

    <back-to-top
      theme="secondary"
      position="bottom-right"
      show-after="200"
    ></back-to-top>

    <!-- Theme Toggle Button -->
    <!-- <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
      <i class="fas fa-moon"></i>
      <i class="fas fa-sun"></i>
    </button> -->

    <main class="container">
      <div class="max-w-4xl mx-auto bg-white mt-8 rounded-lg shadow-sm border border-b border-gray-200">
        <div
          class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16"
        >

          <!-- SyftBox Server URL -->
          <div
            id="syftboxUrl"
            class="hidden bg-blue-50 px-3 py-1 rounded-md border border-blue-200"
          >
            <svg
              class="h-4 w-4 text-blue-500 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
              />
            </svg>
            <a
              id="syftboxUrlLink"
              href="#"
              target="_blank"
              rel="noopener noreferrer"
              class="text-xs text-blue-600 hover:text-blue-800 hover:underline font-mono truncate max-w-32"
              title="SyftBox Server URL"
            >
            </a>
          </div>

          <!-- User Info -->
          <div class="flex items-center space-x-4">
            <div
              class="flex items-center space-x-3 bg-gray-50 px-3 py-1 rounded-md border border-gray-200"
            >
              <svg
                class="h-4 w-4 text-gray-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.655 6.879 1.804M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                />
              </svg>
              <span class="text-xs text-gray-700"
                >User:
                <span id="username" class="font-medium">Loading...</span></span
              >
            </div>
            <div
              class="flex items-center space-x-2 bg-gray-50 px-3 py-1 rounded-md border border-gray-200"
            >
              <span class="text-xs text-gray-700">Balance:</span>
              <span class="text-xs text-gray-500">$20</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="max-w-4xl mx-auto py-8">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
          <!-- Header -->
          <div class="px-6 py-4 border-b border-gray-200">
            <h1 class="text-2xl font-bold text-gray-900">Chat</h1>
            <p class="text-gray-600 mt-1">
              Ask questions and get answers from your data sources
            </p>
          </div>

          <!-- Configuration -->
          <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Data Sources -->
              <div>
                <label for="dataSources" class="block text-sm font-medium text-gray-700 mb-2">
                  Data Sources (Search)
                </label>
                <select
                  id="dataSources"
                  multiple
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  size="3"
                ></select>
                <p class="text-xs text-gray-500 mt-1">
                  Select one or more data sources to search (optional)
                </p>
              </div>

              <!-- Chat Source -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Chat Source *
                </label>
                <select
                  id="chatSource"
                  aria-label="Chat Source"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="">Select a chat source</option>
                </select>
                <p class="text-xs text-gray-500 mt-1">
                  Select a chat model to generate responses
                </p>
              </div>
            </div>
          </div>

          <!-- Chat Messages -->
          <div class="px-6 py-4 h-96 overflow-y-auto">
            <div id="chatMessages" class="space-y-4">
              <!-- Empty state -->
              <div id="emptyState" class="text-center text-gray-500 py-8">
                <svg
                  class="mx-auto h-12 w-12 text-gray-400 mb-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                  />
                </svg>
                <p>Start a conversation by typing a message below</p>
              </div>
            </div>
          </div>

          <!-- Error Display -->
          <div
            id="errorDisplay"
            class="hidden px-6 py-3 bg-red-50 border-t border-red-200"
          >
            <div id="errorText" class="text-red-700 text-sm"></div>
          </div>

          <!-- Input -->
          <div class="px-6 py-4 border-t border-gray-200">
            <div class="flex space-x-3">
              <textarea
                id="messageInput"
                placeholder="Type your message here..."
                class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
                rows="3"
              ></textarea>
              <button
                id="sendButton"
                class="self-end px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                Send
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <site-footer></site-footer>

    <!-- <script
      type="text/javascript"
      id="hs-script-loader"
      async
      defer
      src="https://js.hs-scripts.com/6487402.js"
    ></script> -->
    <script type="module" src="./src/scripts/chat.js"></script>
    
    <!-- Theme Toggle Script -->
    <script>
      // Check for saved theme preference, only set if exists
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        document.documentElement.setAttribute('data-theme', savedTheme);
      }
      
      function toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        
        // Dispatch theme change event for components
        window.dispatchEvent(new CustomEvent('themeChanged', { detail: { theme: newTheme } }));
      }
    </script>
  </body>
</html>
